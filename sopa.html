<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sopa de Letras - Seguridad</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f4f7fb;
  --panel: #fff;
  --card: #e9eef7;
  --ink: #1e293b;
  --accent: #2563eb;
  --ok: #16a34a;
  --muted: #64748b;
  --border: #dbe1ea;
}

* { box-sizing: border-box; font-family:'Poppins',sans-serif; }

body {
  margin:0;
  background:var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:8px;
}

.app {
  width:100%;
  max-width:1100px;
  background:var(--panel);
  border-radius:12px;
  padding:12px;
}

h1 {
  text-align:center;
  color:var(--accent);
  margin-bottom:8px;
  font-size:1.5rem;
}

.layout {
  display:grid;
  grid-template-columns:1.5fr 1fr;
  gap:12px;
}

.board {
  display:grid;
  gap:2px;
  background:var(--card);
  border-radius:8px;
  padding:4px;
  border:1px solid var(--border);
}

.cell {
  width:100%;
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#fff;
  border:1px solid var(--border);
  border-radius:4px;
  font-weight:700;
  user-select:none;
  font-size:clamp(12px, 2vw, 16px);
  transition:background .2s;
  min-width:20px;
  min-height:20px;
}

.cell.sel { background:#dbeafe; border-color:var(--accent); }
.cell.found { background:#dcfce7; border-color:var(--ok); color:#065f46; }
.cell.dim { opacity:.4; }

.words {
  display:grid;
  gap:6px;
}

.word {
  background:#fff;
  border:1px solid var(--border);
  border-radius:8px;
  padding:.4rem .6rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:0.9rem;
}

.word.found { border-color:var(--ok); background:#f0fdf4; }

.footer { 
  display:flex; 
  justify-content:space-between; 
  margin-top:8px; 
  color:var(--muted); 
  font-size:.8rem; 
}

@media (max-width:900px) { 
  .layout { grid-template-columns:1fr; }
  .app { padding:10px; }
  h1 { font-size:1.3rem; }
}

@media (max-width:375px) { 
  .app { padding:8px; }
  .board { gap:1px; }
  .cell { 
    min-width:18px; 
    min-height:18px; 
    font-size:10px; 
  }
  .word { 
    padding:.3rem .5rem; 
    font-size:0.8rem; 
  }
  .footer { font-size:.7rem; }
  h1 { font-size:1.1rem; }
}
</style>
</head>
<body>

<div class="app">
  <h1>Sopa de Letras - Seguridad</h1>
  <div class="layout">
    <section>
      <div id="board" class="board"></div>
      <div class="footer">
        <div>Encontradas: <strong id="foundCount">0</strong>/<span id="goal">0</span></div>
        <div id="msg"></div>
      </div>
    </section>
    <section>
      <p style="margin:0 0 6px; font-size:0.9rem;">Palabras a encontrar</p>
      <div id="words" class="words"></div>
    </section>
  </div>
</div>

<script>
const ABC = [..."ABCDEFGHIJKLMNÃ‘OPQRSTUVWXYZ"];
const DIRS = [
  {dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},
  {dx:1,dy:1},{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1}
];
const rand = n => Math.floor(Math.random()*n);
const shuffle = a => { for(let i=a.length-1;i>0;i--){const j=rand(i+1); [a[i],a[j]]=[a[j],a[i]] } return a; }

let size=14, grid=[], words=[], placed=[], found=new Set();
let selecting=false, path=[], firstClick=null;

// Palabras de 14 letras o menos, relacionadas con seguridad
words = [
  "AUTENTICACION", // 13 letras
  "CIBERSEGURIDAD", // 14 letras
  "ENCRIPTACION", // 12 letras
  "ANTIVIRUS", // 9 letras
  "FIREWALL" // 8 letras
];

function nuevoJuego(){
  console.log("Iniciando nuevo juego");
  grid = Array.from({length:size},()=>Array(size).fill(''));
  placed.length=0; path.length=0; firstClick=null; found.clear();
  const sorted = [...words].sort((a,b)=>b.length-a.length); // Ordenar de mayor a menor longitud

  sorted.forEach(w=>{
    if(w.length<=size){ // Permitir palabras de 14 letras o menos
      console.log("Intentando colocar palabra:", w);
      if(colocarPalabra(w)){
        console.log("Palabra colocada:", w);
      } else {
        console.warn("No se pudo colocar palabra:", w);
      }
    }
  });

  // Llenar vacÃ­os
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      if(!grid[y][x]) grid[y][x]=ABC[rand(ABC.length)];
    }
  }

  renderBoard();
  renderWords();
  document.getElementById('goal').textContent = words.length;
  document.getElementById('foundCount').textContent = found.size;
  document.getElementById('msg').textContent = '';
}

function puedeColocar(word,x,y,dir){
  for(let i=0;i<word.length;i++){
    const nx=x+i*dir.dx, ny=y+i*dir.dy;
    if(nx<0||ny<0||nx>=size||ny>=size) return false;
    const c=grid[ny][nx];
    if(c && c!=='' && c!==word[i]) return false;
  }
  return true;
}

function colocarPalabra(word){
  const dirs = shuffle([...DIRS]);
  for(let attempt=0; attempt<500; attempt++){
    const dir = dirs[attempt % dirs.length];
    const maxStartX = dir.dx === 0 ? size : size - word.length * dir.dx;
    const maxStartY = dir.dy === 0 ? size : size - word.length * dir.dy;
    const startX = rand(maxStartX + 1), startY = rand(maxStartY + 1);
    if(puedeColocar(word,startX,startY,dir)){
      const coords=[];
      for(let i=0;i<word.length;i++){
        const x=startX+i*dir.dx, y=startY+i*dir.dy;
        grid[y][x]=word[i];
        coords.push([x,y]);
      }
      placed.push({word,coords});
      return true;
    }
  }
  return false;
}

function renderBoard(){
  console.log("Renderizando tablero");
  const board=document.getElementById('board');
  board.innerHTML='';
  board.style.gridTemplateColumns=`repeat(${size}, 1fr)`;
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const div=document.createElement('div');
      div.className='cell'; div.dataset.x=x; div.dataset.y=y;
      div.textContent=grid[y][x];
      div.addEventListener('mousedown', startSel);
      div.addEventListener('mouseenter', extendSel);
      div.addEventListener('mouseup', endSel);
      div.addEventListener('click', handleClick);
      div.addEventListener('touchstart', startSelTouch, {passive:true});
      div.addEventListener('touchmove', extendSelTouch, {passive:true});
      div.addEventListener('touchend', touchEndHandler);
      board.appendChild(div);
    }
  }
  document.addEventListener('mouseup', ()=> selecting && endSel());
  document.addEventListener('touchend', ()=> selecting && endSel());
}

function renderWords(){
  console.log("Renderizando lista de palabras");
  const cont=document.getElementById('words'); cont.innerHTML='';
  words.forEach(w=>{
    const div=document.createElement('div'); div.className='word'; div.id=`w-${w}`;
    div.innerHTML=`<span>${w}</span><small id="s-${w}">â€”</small>`;
    cont.appendChild(div);
  });
}

function startSel(e){ 
  selecting=true; clearTemp(); addToPath(e.currentTarget); 
  console.log("Inicio selecciÃ³n (mouse):", e.currentTarget.dataset.x, e.currentTarget.dataset.y);
}

function extendSel(e){ 
  if(selecting) addToPath(e.currentTarget); 
}

function startSelTouch(e){ 
  const el = document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)?.closest('.cell'); 
  if(el){
    selecting=true; clearTemp(); addToPath(el);
    console.log("Inicio selecciÃ³n (toque):", el.dataset.x, el.dataset.y);
  }
}

function extendSelTouch(e){ 
  const el = document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)?.closest('.cell'); 
  if(el && selecting) addToPath(el);
}

function touchEndHandler(e){ 
  if(selecting) endSel();
  console.log("Fin selecciÃ³n (toque)");
}

function handleClick(e){
  const cell = e.currentTarget;
  const x = parseInt(cell.dataset.x), y = parseInt(cell.dataset.y);
  console.log("Clic en celda:", x, y);
  if(!firstClick){ 
    firstClick={x,y}; clearTemp(); cell.classList.add('sel'); 
  } else {
    const line = getLineBetween(firstClick,{x,y});
    if(line){ 
      clearTemp(); path = line; 
      path.forEach(pt=>getCell(pt.x,pt.y)?.classList.add('sel')); 
      endSel(); 
    } else { 
      clearTemp(); firstClick={x,y}; cell.classList.add('sel'); 
    }
    firstClick=null;
  }
}

function getLineBetween(a,b){
  const dx=b.x-a.x, dy=b.y-a.y;
  const stepX=Math.sign(dx), stepY=Math.sign(dy);
  if(dx!==0 && dy!==0 && Math.abs(dx)!==Math.abs(dy)) return null;
  const len=Math.max(Math.abs(dx),Math.abs(dy))+1;
  if(len > size) return null; // No permitir selecciones mÃ¡s largas que el tablero
  const arr=[];
  let x=a.x, y=a.y;
  for(let i=0;i<len;i++){ 
    if(x<0 || x>=size || y<0 || y>=size) return null;
    arr.push({x,y}); 
    x+=stepX; y+=stepY; 
  }
  return arr;
}

function endSel(){
  if(!path.length) return;
  selecting=false;
  const palabra=path.map(c=>grid[c.y][c.x]).join('');
  const palabraR=[...palabra].reverse().join('');
  console.log("Palabra seleccionada:", palabra);
  const match=placed.find(p=>{ const s=p.coords.map(c=>grid[c[1]][c[0]]).join(''); return s===palabra||s===palabraR; });
  if(match && !found.has(match.word)){
    found.add(match.word);
    path.forEach(c=>getCell(c.x,c.y)?.classList.add('found'));
    document.getElementById(`w-${match.word}`)?.classList.add('found');
    document.getElementById(`s-${match.word}`).textContent='âœ…';
    document.getElementById('foundCount').textContent=found.size;
    console.log("Palabra encontrada:", match.word, "Total encontradas:", found.size);
    if(found.size===words.length) {
      console.log("Juego completado");
      document.getElementById('msg').textContent='ðŸŽ‰ Â¡Completado!';
    }
  } else { 
    console.log("Palabra no vÃ¡lida o ya encontrada");
    path.forEach(c=>getCell(c.x,c.y)?.classList.add('dim')); 
    setTimeout(()=>path.forEach(c=>getCell(c.x,c.y)?.classList.remove('dim')),300); 
  }
  clearTemp(true);
}

function addToPath(cellEl){
  if(!cellEl || !cellEl.classList) return;
  const x=parseInt(cellEl.dataset.x), y=parseInt(cellEl.dataset.y);
  if(path.length && path[path.length-1].x===x && path[path.length-1].y===y) return;
  path.push({x,y});
  cellEl.classList.add('sel');
  console.log("AÃ±adiendo a la selecciÃ³n:", x, y);
}

function clearTemp(keep=false){
  document.querySelectorAll('.cell.sel').forEach(c=>c.classList.remove('sel'));
  if(!keep) document.querySelectorAll('.cell.dim').forEach(c=>c.classList.remove('dim'));
  path.length=0;
}

function getCell(x,y){ return document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`); }

nuevoJuego();
</script>

</body>
</html>
