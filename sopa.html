<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sopa de Letras - Comidas típicas</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    /><style>
:root {
  --bg: #f4f7fb;
  --panel: #fff;
  --card: #e9eef7;
  --ink: #1e293b;
  --accent: #2563eb;
  --ok: #16a34a;
  --muted: #64748b;
  --border: #dbe1ea;
}

* { box-sizing: border-box; font-family:'Raleway',sans-serif; }

body {
  margin:0;
  background:var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:8px;
}

.app {
  width:100%;
  max-width:1100px;
  background:var(--panel);
  border-radius:12px;
  padding:12px;
}

h1 {
  text-align:center;
  color: rgb(23, 4, 150);
  margin-bottom:8px;
  font-size:1.5rem;
}

.layout {
  display:grid;
  grid-template-columns:1.5fr 1fr;
  gap:12px;
}

.board {
  display: grid;
  gap: 2px;
  background: var(--card);
  border-radius: 8px;
  padding: 4px;
  border: 1px solid var(--border);

  /* Evitar scroll */
  width: 100%;
  height: auto;      /* que se ajuste al contenido */
  max-width: 100%;   /* no exceda contenedor */
  overflow: hidden;  /* desactiva scroll */
}


.cell {
  width:100%;
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#fff;
  border:1px solid var(--border);
  border-radius:4px;
  font-weight:700;
  user-select:none;
  font-size:clamp(12px, 2vw, 16px);
  transition:background .2s;
  min-width:20px;
  min-height:20px;
    color: #021034; /* azul oscuro */

}


.cell.sel { background:#dbeafe; border-color:var(--accent); }
.cell.found { 
  background:#dbeafe;       /* azul claro */
  border-color:#3b82f6;     /* azul brillante */
  color:#1e3a8a;            /* texto azul oscuro */
}
.cell.dim { 
  background: #fed7aa; /* naranja claro de fondo */
}


.words { display:grid; gap:6px; }

.word {
  background:#fff;
  border:1px solid var(--border);
  border-radius:8px;
  padding:.4rem .6rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:0.9rem;
}

.word.found {
  border-color: #3b82f6;  /* azul brillante para el borde */
  background: #dbeafe;    /* azul claro de fondo */
  color: #1e3a8a;         /* azul oscuro para el texto */
}


.footer { 
  display:flex; 
  justify-content:space-between; 
  margin-top:8px; 
  color:var(--muted); 
  font-size:.8rem; 
}




@media (max-width:900px) { 
  .layout { grid-template-columns:1fr; }
  .app { padding:10px; }
  h1 { font-size:1.3rem; }
}

@media (max-width:375px) { 
  .app { padding:8px; }
  .board { gap:1px; }
  .cell { min-width:18px; min-height:18px; font-size:10px; }
  .word { padding:.3rem .5rem; font-size:0.8rem; }
  .footer { font-size:.7rem; }
  h1 { font-size:1.1rem; }
}
</style>
</head>
<body>

<div class="app">
  <h1>Sopa de Letras - Comidas típicas</h1>
  <div class="layout">
    <section>
      <div id="board" class="board"></div>
      <div class="footer">
        <div>Encontradas: <strong id="foundCount">0</strong>/<span id="goal">0</span></div>
        <div id="msg"></div>
        
      <button id="btnRestart" style="margin-top:10px; padding:6px 12px; border-radius:6px; border:none; background:#021e5b; color:white; cursor:pointer;">
  Reiniciar Sopa
</button>
      </div>



    </section>
    <section>
      <p style="margin:0 0 6px; font-size:0.9rem;">Palabras a encontrar</p>
      <div id="words" class="words"></div>
    </section>
  </div>


<modal-pareo 
    id="modal1"
    title="¡Felicidades! Has completado la sopa de letras." 
    img="vuela.png"
    link="https://www.prodhab.go.cr/"
    animated
    float
    opaque>
</modal-pareo>


<modal-pareo 
    id="modal2"
title="Encuentra las palabras seleccionando de la primera a la última letra."
    video="superdato_anotando.webm"
    link="https://www.prodhab.go.cr/"
        opaque>

</modal-pareo>


</div>

<script src="modal-juego.js"></script>
<script>
const ABC = [..."ABCDEFGHIJKLMNÑOPQRSTUVWXYZ"];
const DIRS = [
  {dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},
  {dx:1,dy:1},{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1}
];
const rand = n => Math.floor(Math.random()*n);
const shuffle = a => { for(let i=a.length-1;i>0;i--){const j=rand(i+1); [a[i],a[j]]=[a[j],a[i]] } return a; }

let size=14, grid=[], placed=[], found=new Set();
let selecting=false, path=[], firstClick=null;

let words = [
  "GALLOPINTO",
  "TAMALES",
  "CHORREADAS",
  "CASADO",
  "OLLADECARNE",
  "SOPANEGRA", 
  "CHIFRIJO"];

words = words.slice(0,7).filter(w=>w.length<=14);

function nuevoJuego(){
  grid = Array.from({length:size},()=>Array(size).fill(''));
  placed.length=0; path.length=0; firstClick=null; found.clear();
  const sorted = [...words].sort((a,b)=>b.length-a.length);

  sorted.forEach(w=>colocarPalabra(w));

  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      //if(!grid[y][x]) grid[y][x]="";
            if(!grid[y][x]) grid[y][x]=ABC[rand(ABC.length)];

    }
  }

  renderBoard();
  renderWords();
  document.getElementById('goal').textContent = words.length;
  document.getElementById('foundCount').textContent = found.size;
  document.getElementById('msg').textContent = '';
}

function colocarPalabra(word){
  const dirs = shuffle([...DIRS]);
  const reversed = Math.random()<0.5;
  const w = reversed ? [...word].reverse().join('') : word;
  let bestSpot = null;
  let bestOverlap = -1;

  for(const dir of dirs){
    let minX = 0, maxX = size-1, minY = 0, maxY = size-1;
    if(dir.dx === 1) maxX = size - w.length;
    if(dir.dx === -1) minX = w.length - 1;
    if(dir.dy === 1) maxY = size - w.length;
    if(dir.dy === -1) minY = w.length - 1;

    for(let y=minY; y<=maxY; y++){
      for(let x=minX; x<=maxX; x++){
        let overlap = 0, valid = true;
        for(let i=0;i<w.length;i++){
          const nx=x+i*dir.dx, ny=y+i*dir.dy;
          const c=grid[ny][nx];
          if(nx<0||ny<0||nx>=size||ny>=size){ valid=false; break; }
          if(c && c!=='' && c!==w[i]){ valid=false; break; }
          if(c === w[i]) overlap++;
        }
        if(valid && overlap > bestOverlap){
          bestOverlap = overlap;
          bestSpot = {x,y,dir};
        }
      }
    }
  }

  if(bestSpot){
    const {x,y,dir} = bestSpot;
    const coords=[];
    for(let i=0;i<w.length;i++){
      const nx=x+i*dir.dx, ny=y+i*dir.dy;
      grid[ny][nx]=w[i];
      coords.push([nx,ny]);
    }
    placed.push({word,coords});
    return true;
  }
  return false;
}

function renderBoard(){
  const board=document.getElementById('board');
  board.innerHTML='';
  board.style.gridTemplateColumns=`repeat(${size}, 1fr)`;
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const div=document.createElement('div');
      div.className='cell'; div.dataset.x=x; div.dataset.y=y;
      div.textContent=grid[y][x];
      div.addEventListener('mousedown', startSel);
      div.addEventListener('mouseenter', extendSel);
      div.addEventListener('mouseup', endSel);
      div.addEventListener('click', handleClick);
      div.addEventListener('touchstart', startSelTouch, {passive:true});
      div.addEventListener('touchmove', extendSelTouch, {passive:true});
      div.addEventListener('touchend', touchEndHandler);
      board.appendChild(div);
    }
  }
  document.addEventListener('mouseup', ()=> selecting && endSel());
  document.addEventListener('touchend', ()=> selecting && endSel());
}

function renderWords(){
  const cont=document.getElementById('words'); cont.innerHTML='';
  words.forEach(w=>{
    const div=document.createElement('div'); div.className='word'; div.id=`w-${w}`;
    div.innerHTML=`<span>${w}</span><small id="s-${w}">—</small>`;
    cont.appendChild(div);
  });
}

function startSel(e){ selecting=true; clearTemp(); addToPath(e.currentTarget); }
function extendSel(e){ if(selecting) addToPath(e.currentTarget); }
function startSelTouch(e){ 
  const el = document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)?.closest('.cell'); 
  if(el){ selecting=true; clearTemp(); addToPath(el); }
}
function extendSelTouch(e){ 
  const el = document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)?.closest('.cell'); 
  if(el && selecting) addToPath(el);
}
function touchEndHandler(e){ if(selecting) endSel(); }

function handleClick(e){
  const cell = e.currentTarget;
  const x = parseInt(cell.dataset.x), y = parseInt(cell.dataset.y);
  if(!firstClick){ 
    firstClick={x,y}; clearTemp(); cell.classList.add('sel'); 
  } else {
    const line = getLineBetween(firstClick,{x,y});
    if(line){ 
      clearTemp(); path = line; 
      path.forEach(pt=>getCell(pt.x,pt.y)?.classList.add('sel')); 
      endSel(); 
    } else { 
      clearTemp(); firstClick={x,y}; cell.classList.add('sel'); 
    }
    firstClick=null;
  }
}

function getLineBetween(a,b){
  const dx=b.x-a.x, dy=b.y-a.y;
  const stepX=Math.sign(dx), stepY=Math.sign(dy);
  if(dx!==0 && dy!==0 && Math.abs(dx)!==Math.abs(dy)) return null;
  const len=Math.max(Math.abs(dx),Math.abs(dy))+1;
  if(len > size) return null;
  const arr=[];
  let x=a.x, y=a.y;
  for(let i=0;i<len;i++){ 
    if(x<0 || x>=size || y<0 || y>=size) return null;
    arr.push({x,y}); 
    x+=stepX; y+=stepY; 
  }
  return arr;
}

function endSel(){
  if(!path.length) return;
  selecting=false;
  const palabra=path.map(c=>grid[c.y][c.x]).join('');
  const palabraR=[...palabra].reverse().join('');
  const match=placed.find(p=>{
    const s=p.coords.map(c=>grid[c[1]][c[0]]).join('');
    return s===palabra||s===palabraR;
  });
  if(match && !found.has(match.word)){
    found.add(match.word);
    path.forEach(c=>getCell(c.x,c.y)?.classList.add('found'));
    document.getElementById(`w-${match.word}`)?.classList.add('found');
    document.getElementById('foundCount').textContent=found.size;
    if(found.size===words.length) {
      document.getElementById('msg').textContent='¡Completado!';

      // Seleccionas el modal y la imagen dentro del Shadow DOM
const modal = document.getElementById('modal1');
const img = modal.shadowRoot.querySelector('#character');

// Voltear horizontal (efecto espejo)
img.style.transform = "scaleX(-1)";

// O voltear vertical
// img.style.transform = "scaleY(-1)";

// O rotar 180 grados
// img.style.transform = "rotate(180deg)";

// Cambiar tamaño
img.style.width = '200px';   // ancho fijo
img.style.height = 'auto';   // altura proporcional
// o para máximo ancho relativo al modal
// img.style.maxWidth = '80%'; 

// Abrir modal
modal.open();

    }
  } else { 
    path.forEach(c=>getCell(c.x,c.y)?.classList.add('dim')); 
    setTimeout(()=>path.forEach(c=>getCell(c.x,c.y)?.classList.remove('dim')),300); 
  }
  clearTemp(true);
}

function addToPath(cellEl){
  if(!cellEl || !cellEl.classList) return;
  const x=parseInt(cellEl.dataset.x), y=parseInt(cellEl.dataset.y);
  if(path.length && path[path.length-1].x===x && path[path.length-1].y===y) return;
  path.push({x,y});
  cellEl.classList.add('sel');
}

function clearTemp(keep=false){
  document.querySelectorAll('.cell.sel').forEach(c=>c.classList.remove('sel'));
  if(!keep) document.querySelectorAll('.cell.dim').forEach(c=>c.classList.remove('dim'));
  path.length=0;
}

function getCell(x,y){ return document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`); }

nuevoJuego();
document.getElementById('modal2').open()

document.getElementById('btnRestart').addEventListener('click', () => {
  nuevoJuego();
});

</script>

</body>
</html>
