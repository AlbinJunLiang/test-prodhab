<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Juego de Clasificaci√≥n Din√°mico</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Raleway", sans-serif;
      }
      body {
        background: #f8fafc;
        color: #333;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 10px;
      }
      .container {
        max-width: 1000px;
        width: 100%;
        margin: auto;
      }
      header {
        text-align: center;
        margin-bottom: 15px;
      }
      h1 {
        font-size: 2rem;
        color: #1e355e;
        font-weight: 700;
        margin-bottom: 5px;
      }
      .card {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        align-items: stretch;
        grid-auto-rows: auto;
      }
      .col-head {
        text-align: center;
        color: #1e355e;
        border-bottom: 2px solid #e2e8f0;
        padding-bottom: 5px;
        margin-bottom: 10px;
        font-size: 1.1rem;
        font-weight: 700;
      }
      .row {
        display: contents;
      }
      .item,
      .target {
        background: #f7f7f7;
        padding: 12px;
        border-radius: 8px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 60px;
        display: block;
        min-width: 0;
        overflow-wrap: anywhere;
        word-break: break-word;
        white-space: normal;
        text-align: left;
        position: relative;
      }
      .item.selected,
      .target.selected {
        background: #dbeafe;
        border-color: #2563eb;
      }
      .disabled {
        background: #e2e8f0;
        color: #94a3b8;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .correct {
        border-color: #1e355e;
        background: #f0fdf4;
        cursor: not-allowed;
      }
      .incorrect {
        border-color: #c74b27;
        background: #fef2f2;
      }
      .score-panel {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
      }
      .reset-button {
        background: #1e355e;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s ease; /* transici√≥n suave */
      }

      .reset-button:hover {
        transform: scale(1.1); /* se agranda un 10% al pasar el mouse */
      }

      .completed-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: none;
        text-align: center;
      }

      .feedback {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.8rem;
        font-weight: bold;
        display: none;
        z-index: 9999;
        text-align: center;
      }

      .feedback.correcto {
        color: #1e355e;
      }

      .feedback.incorrecto {
        color: #c74b27;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1 id="titulo-pareo">Juego de Clasificaci√≥n Din√°mico</h1>
        <p class="subtitle">Relaciona cada tipo con su ejemplo correcto</p>
      </header>

      <div
        style="
          height: 50px;
          display: flex;
          justify-content: center; /* centra horizontalmente */
          align-items: center; /* centra verticalmente */
          position: relative; /* por si quieres position absolute dentro */
        "
      >
        <img
          src="superdato_1.png"
          alt="Robot se√±alando"
          style="
            width: 130px; /* tama√±o del robot */
            pointer-events: none; /* no bloquea interacciones */
            margin-top: 1%;
          "
        />
      </div>

      <div class="card" id="game-board"></div>

      <div class="score-panel">
        <div id="score"></div>
        <button class="reset-button" id="reset-button">Reiniciar</button>
      </div>

      <modal-pareo
        title="¬°Muy bien!"
        img="superdato_volando.png"
        link="https://www.prodhab.go.cr/"
      >
      </modal-pareo>
      <div id="feedback" class="feedback"></div>
    </div>

    <script>
      // Banco organizado por temas
      const bancoDePares = {
        datos: [
          {
            tipo: "Datos de Acceso Irrestricto",
            ejemplo: "Nombres en un directorio p√∫blico",
          },
          {
            tipo: "Datos de Acceso Restringido",
            ejemplo: "Datos de registros p√∫blicos con acceso limitado",
          },
          {
            tipo: "Datos Sensibles",
            ejemplo: "Informaci√≥n sobre la salud de una persona",
          },
          {
            tipo: "Datos de Comportamiento Crediticio",
            ejemplo: "Historial de pagos de un pr√©stamo",
          },
        ],
        ciberseguridad: [
          {
            tipo: "Phishing",
            ejemplo:
              "Correo falso que simula ser de un banco para robar credenciales",
          },
          {
            tipo: "Malware",
            ejemplo:
              "Programa malicioso que da√±a o roba informaci√≥n de un sistema",
          },
          {
            tipo: "Firewall",
            ejemplo: "Sistema que filtra el tr√°fico de red no autorizado",
          },
          {
            tipo: "Ingenier√≠a Social",
            ejemplo:
              "Enga√±ar a una persona para obtener contrase√±as o datos sensibles",
          },
        ],
        prodhab: [
          {
            tipo: "Creaci√≥n de PRODHAB",
            ejemplo: "Se estableci√≥ en 2011 mediante la Ley N.¬∫ 8968",
          },
          {
            tipo: "Misi√≥n",
            ejemplo:
              "Proteger la privacidad de los ciudadanos y regular el uso de datos personales",
          },
          {
            tipo: "Dependencia",
            ejemplo:
              "Adscrita al Ministerio de Justicia y Paz con independencia t√©cnica y administrativa",
          },
          {
            tipo: "Direcci√≥n Nacional",
            ejemplo:
              "Dicta pol√≠ticas generales en materia t√©cnica, administrativa y organizacional",
          },
          {
            tipo: "Auditor√≠a Interna",
            ejemplo:
              "Fiscaliza bienes, operaciones y obligaciones de la Agencia",
          },
          {
            tipo: "Visi√≥n",
            ejemplo:
              "Ser reconocida por transparencia y buenas pr√°cticas en protecci√≥n de datos",
          },
          {
            tipo: "Resoluci√≥n relevante",
            ejemplo:
              "Resoluci√≥n N.¬∫ 697‚Äì2023: medida cautelar sobre acceso a informaci√≥n de cr√©dito",
          },
          {
            tipo: "Derecho protegido",
            ejemplo:
              "Autodeterminaci√≥n informativa: control sobre los datos personales",
          },
        ],
      };

      // Funci√≥n para elegir un tema aleatorio
      function obtenerTemaAleatorio() {
        const temas = Object.keys(bancoDePares);
        const randomIndex = Math.floor(Math.random() * temas.length);
        return temas[randomIndex];
      }

      // Funci√≥n para seleccionar pares de un tema aleatorio
      function obtenerParesAleatorios(n) {
        const tema = obtenerTemaAleatorio(); // üé≤ Tema al azar
        const pares = bancoDePares[tema];

        const seleccionados = [];
        const usados = new Set();

        while (seleccionados.length < n && usados.size < pares.length) {
          const randomIndex = Math.floor(Math.random() * pares.length);
          if (!usados.has(randomIndex)) {
            seleccionados.push(pares[randomIndex]);
            usados.add(randomIndex);
          }
        }

        return { tema, pares: seleccionados };
      }

      // Ejemplo: dame 3 pares de un tema aleatorio
      const { tema, pares } = obtenerParesAleatorios(4);

      console.log("Tema elegido:", tema);
      console.log("Pares:", pares);

      let score = 0;
      let matchedPairs = 0;
      let selected = null;
      let dragData = null;

      function shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function generarJuego() {
        document.getElementById(
          "score"
        ).innerText = `Puntos: 0/${pares.length}`;
        document.getElementById(
          "titulo-pareo"
        ).innerHTML = `Juego de pareo: <b>${tema}</b>`;

        const board = document.getElementById("game-board");
        board.innerHTML = `<div class="col-head">Tipos</div><div class="col-head">Ejemplos</div>`;

        const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
          .split("")
          .slice(0, pares.length);

        // Mezclar los tipos
        const tiposAleatorios = shuffle([...pares]);

        // Crear letra visual para cada tipo
        const tipoLetraMap = {};
        tiposAleatorios.forEach((tipo, index) => {
          tipoLetraMap[tipo.tipo] = letras[index];
        });

        // Mezclar ejemplos
        const ejemplosAleatorios = shuffle([...pares]);

        for (let i = 0; i < pares.length; i++) {
          const tipo = tiposAleatorios[i];
          const letra = tipoLetraMap[tipo.tipo];
          const ejemplo = ejemplosAleatorios[i];

          const row = document.createElement("div");
          row.className = "row";
          row.innerHTML = `
      <div class="item" draggable="true" data-tipo="${
        tipo.tipo
      }" data-letra="${letra}">
        ${letra}) ${tipo.tipo}
      </div>
      <div class="target" draggable="true" data-tipo="${
        ejemplo.tipo
      }" data-letra="${tipoLetraMap[ejemplo.tipo]}">
        ${ejemplo.ejemplo}
      </div>
    `;
          board.appendChild(row);
        }
      }

      function areOppositeSides(a, b) {
        return a.classList.contains("item") !== b.classList.contains("item");
      }
      function checkMatch(el1, el2) {
        if (!areOppositeSides(el1, el2)) return;
        const tipo1 = el1.dataset.tipo;
        const tipo2 = el2.dataset.tipo;

        if (tipo1 === tipo2) {
          mostrarFeedback("¬°Correcto!", true);

          const letra = el1.dataset.letra || el2.dataset.letra;

          // Si es item (izquierda) ya tiene letra, no la repito
          if (el1.classList.contains("item")) {
            el2.textContent = `${letra}) ${el2.textContent.replace(
              /^[A-Z]\)\s*/,
              ""
            )}`;
          } else {
            el1.textContent = `${letra}) ${el1.textContent.replace(
              /^[A-Z]\)\s*/,
              ""
            )}`;
          }

          [el1, el2].forEach((el) => {
            el.classList.add("correct", "disabled");
            el.removeAttribute("draggable");
            el.classList.remove("selected");
          });

          score++;
          matchedPairs++;
          document.getElementById(
            "score"
          ).textContent = `Puntos: ${score}/${pares.length}`;
          if (matchedPairs === pares.length) {
            setTimeout(() => document.querySelector("modal-pareo").open(), 300);
          }
        } else {
          el2.classList.add("incorrect");
          mostrarFeedback("Incorrecto", false);

          setTimeout(() => el2.classList.remove("incorrect"), 500);
          el1.classList.remove("selected");
        }
      }

      function resetGame() {
        const { tema, pares } = obtenerParesAleatorios(4);
        score = 0;
        matchedPairs = 0;
        selected = null;
        dragData = null;
        document.getElementById(
          "score"
        ).textContent = `Puntos: ${score}/${pares.length}`;
        generarJuego();
        activarEventos();
        document.querySelector("modal-pareo").close();
        document.getElementById(
          "titulo-pareo"
        ).innerHTML = `Juego de pareo: <b>${tema}</b>`;
      }

      function activarEventos() {
        const cells = document.querySelectorAll(".item, .target");
        cells.forEach((el) => {
          el.addEventListener("click", () => {
            if (el.classList.contains("disabled")) return;
            if (!selected) {
              el.classList.add("selected");
              selected = el;
              return;
            }
            if (!areOppositeSides(selected, el)) {
              selected.classList.remove("selected");
              el.classList.add("selected");
              selected = el;
              return;
            }
            checkMatch(selected, el);
            selected = null;
          });

          el.addEventListener("dragstart", (e) => {
            if (el.classList.contains("disabled")) {
              e.preventDefault();
              return;
            }
            dragData = el;
            e.dataTransfer.setData("text/plain", el.dataset.tipo);
          });

          el.addEventListener("dragend", () => (dragData = null));

          el.addEventListener("dragover", (e) => {
            if (
              !el.classList.contains("disabled") &&
              dragData &&
              areOppositeSides(dragData, el)
            )
              e.preventDefault();
          });

          el.addEventListener("drop", (e) => {
            e.preventDefault();
            if (!dragData || el.classList.contains("disabled")) return;
            if (!areOppositeSides(dragData, el)) return;
            checkMatch(dragData, el);
            dragData = null;
          });
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        generarJuego();
        activarEventos();
        document
          .getElementById("reset-button")
          .addEventListener("click", resetGame);
      });

      function mostrarFeedback(mensaje, esCorrecto) {
        const feedback = document.getElementById("feedback");
        feedback.textContent = mensaje;
        feedback.className =
          "feedback " + (esCorrecto ? "correcto" : "incorrecto");
        feedback.style.display = "block";

        setTimeout(() => {
          feedback.style.display = "none";
        }, 1000); // desaparece despu√©s de 1 segundo
      }
    </script>
    <script src="modal-pareo.js"></script>
  </body>
</html>
